<!DOCTYPE html>
<html>
<head>
  <title>Edit Family</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    function setParentId(id) {
      document.getElementById('grandchildParentId').value = id;
    }
  </script>
</head>
<body>

<div class="container mt-4">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4>Edit Family</h4>
    <a href="/admin/dashboard" class="btn btn-danger btn-sm">X</a>
  </div>

  <% if (message) { %>
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      <%= message %>
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
  <% } %>

  <!-- Parent Details -->
  <% if (parent) { %>
  <div class="card mb-4">
    <div class="card-header"><h5>Parent Details</h5></div>
    <div class="card-body">
      <form method="POST" action="/admin/edit/<%= parent.id %>">
        <div class="row">
          <div class="col-md-6 mb-2">
            <label class="form-label">Name</label>
            <input class="form-control" name="name" value="<%= parent.name %>" required>
          </div>
          <div class="col-md-6 mb-2">
            <label class="form-label">Mobile</label>
            <input class="form-control" name="mobile" value="<%= parent.mobile %>" required>
          </div>
          <div class="col-md-6 mb-2">
            <label class="form-label">Email</label>
            <input class="form-control" name="email" value="<%= parent.email %>" required>
          </div>
          <div class="col-md-6 mb-2">
            <label class="form-label">Occupation</label>
            <input class="form-control" name="occupation" value="<%= parent.occupation %>">
          </div>
          <div class="col-md-6 mb-2">
            <label class="form-label">Date of Birth</label>
            <input type="date" class="form-control" name="dob" value="<%= parent.dob ? new Date(parent.dob).toISOString().split('T')[0] : '' %>">
          </div>
          <div class="col-md-6 mb-2">
            <label class="form-label">Gender</label>
            <select class="form-control" name="gender">
              <option value="Male" <%= parent.gender === 'Male' ? 'selected' : '' %>>Male</option>
              <option value="Female" <%= parent.gender === 'Female' ? 'selected' : '' %>>Female</option>
              <option value="Other" <%= parent.gender === 'Other' ? 'selected' : '' %>>Other</option>
            </select>
          </div>
        </div>
        <button class="btn btn-success">Update Parent</button>
      </form>
    </div>
  </div>
  <% } %>

  <!-- Children -->
  <div class="card mb-4">
    <div class="card-header"><h5>Children</h5></div>
    <div class="card-body">
      <% if (children && children.length > 0) { %>
        <% children.forEach(child => { %>
        <div class="border p-3 mb-3">
          <form method="POST" action="/admin/edit/<%= child.id %>">
            <div class="row">
              <div class="col-md-6 mb-2">
                <label class="form-label">Name</label>
                <input class="form-control" name="name" value="<%= child.name %>" required>
              </div>
              <div class="col-md-6 mb-2">
                <label class="form-label">Date of Birth</label>
                <input type="date" class="form-control" name="dob" value="<%= child.dob ? new Date(child.dob).toISOString().split('T')[0] : '' %>">
              </div>
            </div>
            <button class="btn btn-success">Update Child</button>
          </form>
          <button class="btn btn-primary btn-sm mt-2" data-bs-toggle="modal" data-bs-target="#addChildModal">Add Member</button>
          <button class="btn btn-secondary btn-sm mt-2" data-bs-toggle="modal" data-bs-target="#addGrandChildModal" onclick="setParentId('<%= child.id %>')">Add Child</button>
        </div>
        <% }); %>
      <% } else { %>
        <p>No children added yet.</p>
      <% } %>
    </div>
  </div>

  <!-- Add Child Modal -->
  <div class="modal fade" id="addChildModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Add Member</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body">
          <form method="POST" action="/admin/add-child">
            <input type="hidden" name="parent_id" value="<%= parent.id %>">
            <div class="row">
              <div class="col-md-6 mb-2"><label class="form-label">Name</label><input class="form-control" name="name" required></div>
              <div class="col-md-6 mb-2"><label class="form-label">Gender</label>
                <select class="form-control" name="gender"><option>Male</option><option>Female</option><option>Other</option></select>
              </div>
            </div>
            <button class="btn btn-success">Add Child</button>
          </form>
        </div>
      </div>
    </div>
  </div>

</div>
</body>
</html>
